---
// CategoryButtons component - Active filters for job categories
export interface Props {
  categories: string[];
}

const { categories = [] } = Astro.props as Props;

// Map categories to emoji icons
const categoryIcons: Record<string, string> = {
  'Game Dev': 'ðŸŽ®',
  '3D & Animation': 'ðŸŽ¨',
  'Design (UI/UX)': 'ðŸŽ¯',
};
---

<nav class="relative z-10 mb-8 flex flex-wrap justify-center gap-3" aria-label="Filter by category">
  <!-- All Jobs button -->
  <button
    data-category="all"
    class="category-btn category-btn-active rounded-full border-2 border-primary bg-primary px-6 py-3 text-base font-semibold text-white transition-all duration-200 hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
    aria-pressed="true"
  >
    All Jobs
  </button>

  {
    categories.map((cat) => {
      const icon = categoryIcons[cat] || 'ðŸ“‹';
      return (
        <button
          data-category={cat}
          class="category-btn rounded-full border-2 border-neutral-200 bg-background-paper px-6 py-3 text-base font-semibold text-neutral-700 transition-all duration-200 hover:scale-105 hover:border-neutral-300 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2"
          aria-pressed="false"
        >
          <span class="mr-2" aria-hidden="true">
            {icon}
          </span>
          {cat}
        </button>
      );
    })
  }
</nav>

<script>
  // @ts-nocheck
  let selectedCategory = 'all';

  const categoryButtons = Array.from(
    document.querySelectorAll('.category-btn')
  );

  function updateCategoryUI() {
    categoryButtons.forEach((btn) => {
      const cat = btn.dataset.category || '';
      const isActive = cat === selectedCategory;

      if (isActive) {
        btn.classList.add('category-btn-active', 'bg-primary', 'text-white', 'border-primary');
        btn.classList.remove('bg-background-paper', 'text-neutral-700', 'border-neutral-200');
      } else {
        btn.classList.remove('category-btn-active', 'bg-primary', 'text-white', 'border-primary');
        btn.classList.add('bg-background-paper', 'text-neutral-700', 'border-neutral-200');
      }
      btn.setAttribute('aria-pressed', String(isActive));
    });
  }

  function dispatchChange(partial) {
    window.dispatchEvent(new CustomEvent('jobfilters:change', { detail: partial }));
  }

  // Category button click handlers -> update global state
  categoryButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const cat = btn.dataset.category || 'all';
      selectedCategory = cat;
      // Reset search value in UI; global orchestrator will handle filtering
      const searchInput = document.getElementById('job-search');
      if (searchInput) searchInput.value = '';
      dispatchChange({ category: selectedCategory, search: '' });
    });
  });

  // Listen for applied state to keep UI in sync (e.g., on reload via URL params)
  window.addEventListener('jobfilters:applied', (e) => {
    const detail = /** @type {CustomEvent} */ (e).detail || {};
    if (detail.category) {
      selectedCategory = detail.category;
      updateCategoryUI();
    }
  });

  // Initial UI sync
  updateCategoryUI();
</script>
